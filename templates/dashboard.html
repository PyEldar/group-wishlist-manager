{% extends "base.html" %}
{% block content %}
<div class="group-info-banner">
    <h1>Rodina: {{ current_user.group.name }}</h1>
    <div class="invite-box">
        Pozvi ostatn√≠ t√≠mto k√≥dem: <span class="code">{{ current_user.group.join_code }}</span>
    </div>
    <div class="invite-box">
        Nebo t√≠mto odkazem: <span class="code">{{ url_for('index', code=current_user.group.join_code, _external=True) | replace('https://', '') | replace('http://', '') }}</span>
    </div>
</div>
<div class="my-section">
    <h2>üéÅ Moje p≈ô√°n√≠</h2>
    <form action="{{ url_for('add_wish') }}" method="POST" class="add-form">
        <input type="text" name="text" placeholder="Co si p≈ôeje≈°?" required>
        <input type="text" name="url" placeholder="Odkaz (voliteln√©)">
        <button type="submit">P≈ôidat</button>
    </form>
    <ul class="wish-list">
        {% for wish in current_user.wishes %}
        <li>
            <div class="wish-info">
                <span class="wish-text">{{ wish.text }}</span>
                {% if wish.url %}
                    <a href="{{ wish.url if wish.url.startswith('http') else 'https://' + wish.url }}" target="_blank" class="link-icon">üîó</a>
                {% endif %}
            </div>
            <a href="{{ url_for('delete_wish', wish_id=wish.id) }}" class="delete-btn">√ó</a>
        </li>
        {% else %}
        <p class="empty">Zat√≠m sis nic nep≈ô√°l(a).</p>
        {% endfor %}
    </ul>
</div>
<hr>
<h2>üéÖ P≈ô√°n√≠ ostatn√≠ch</h2>
<div class="family-grid">
    {% for user in users %}
        {% if user != current_user %}
        <div class="family-card">
            <h3>{{ user.display_name }}</h3>
            <ul class="wish-list">
                {% for wish in user.wishes %}
                <li class="{% if wish.reserved_by and wish.reserved_by != current_user.id %}taken{% endif %}">
                    <div class="wish-content">
                        <strong>{{ wish.text }}</strong>
                        {% if wish.url %}
                            <a href="{{ wish.url if wish.url.startswith('http') else 'https://' + wish.url }}" target="_blank">üîó</a>
                        {% endif %}
                    </div>
                    <div class="actions">
                        {% if wish.reserved_by == current_user.id %}
                            <a href="{{ url_for('toggle_reserve', wish_id=wish.id) }}" class="btn-reserved">‚úÖ Rezervovano</a>
                        {% elif wish.reserved_by %}
                            <span class="status-taken">Zabran√©</span>
                        {% else %}
                            <a href="{{ url_for('toggle_reserve', wish_id=wish.id) }}" class="btn-reserve">Rezervovat</a>
                        {% endif %}
                    </div>
                </li>
                {% else %}
                <p class="empty">Zat√≠m nic.</p>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    {% endfor %}
</div>
{% endblock %}